# Diretrizes de Build e Deploy - Adventure CRM

## üö® CHECKLIST OBRIGAT√ìRIO ANTES DE COMMIT

### 1. Verifica√ß√£o de TypeScript
- [ ] **SEMPRE** executar `npm run type-check` ou `tsc --noEmit` antes de commitar
- [ ] Verificar se todos os tipos est√£o corretos e completos
- [ ] Garantir que interfaces/tipos importados existem e est√£o atualizados
- [ ] Verificar se propriedades opcionais est√£o marcadas com `?`
- [ ] Confirmar que tipos de retorno de fun√ß√µes est√£o corretos

### 2. Imports e Depend√™ncias
- [ ] Remover imports n√£o utilizados (especialmente componentes como `Card`, `Button`, etc.)
- [ ] Verificar se todos os imports est√£o corretos e os caminhos existem
- [ ] Confirmar que hooks customizados est√£o importados corretamente
- [ ] Verificar se tipos est√£o sendo importados de `@/types` quando necess√°rio

### 3. Propriedades de Contextos e Hooks
- [ ] **CR√çTICO**: Verificar propriedades dispon√≠veis em contextos antes de usar
  - `ProjectContext` tem: `currentProject`, `setCurrentProject`, `loading`, `isMaster`
  - **N√ÉO existe** `loadingProjects` no `ProjectContext`
- [ ] Verificar se hooks retornam as propriedades esperadas
- [ ] Confirmar que valores opcionais s√£o tratados com `?.` ou verifica√ß√µes `if`

### 4. Tipos e Interfaces
- [ ] **SEMPRE** atualizar tipos em `src/types/index.ts` quando adicionar novos campos
- [ ] Verificar se campos opcionais est√£o marcados com `?` quando necess√°rio
- [ ] Confirmar que tipos estendem `BaseEntity` quando apropriado
- [ ] Verificar se enums est√£o corretos (ex: `'martech' | 'custom'` para funis)

### 5. Componentes e Props
- [ ] Verificar se todas as props obrigat√≥rias est√£o sendo passadas
- [ ] Confirmar que props opcionais t√™m valores padr√£o quando necess√°rio
- [ ] Verificar se componentes filhos recebem props corretas

### 6. Valida√ß√£o de Dados
- [ ] Verificar se campos obrigat√≥rios est√£o validados no schema (Zod)
- [ ] Confirmar que valores `undefined` s√£o tratados corretamente
- [ ] Verificar se arrays opcionais s√£o inicializados como `[]` quando necess√°rio

### 7. √çcones e Emojis
- [ ] **N√ÉO usar emojis** - sempre usar √≠cones do `react-icons` ou componente `Icon`
- [ ] Verificar se √≠cones importados existem no `react-icons/fi`
- [ ] Confirmar que √≠cones est√£o registrados em `src/components/icons/Icon.tsx`

### 8. Hooks Customizados
- [ ] Verificar se hooks filtram por `projectId` quando necess√°rio
- [ ] Confirmar que hooks usam `currentProject` do `ProjectContext` corretamente
- [ ] Verificar se hooks tratam casos onde `currentProject` √© `null`

### 9. Firestore e Database
- [ ] Verificar se `projectId` est√° sendo inclu√≠do em cria√ß√µes de documentos
- [ ] Confirmar que queries filtram por `projectId` quando necess√°rio
- [ ] Verificar se tipos de Timestamp est√£o corretos

### 10. Rotas e Navega√ß√£o
- [ ] Verificar se rotas est√£o registradas em `src/routes/index.tsx`
- [ ] Confirmar que componentes de p√°gina est√£o importados corretamente
- [ ] Verificar se rotas protegidas usam `PrivateRoute`

## üîç ERROS COMUNS E COMO EVITAR

### Erro: "Property 'X' does not exist on type 'Y'"
**Causa**: Propriedade n√£o existe no tipo ou interface
**Solu√ß√£o**: 
- Verificar o tipo/interface em `src/types/index.ts`
- Adicionar a propriedade se necess√°rio
- Verificar se est√° usando a propriedade correta (ex: `loading` vs `loadingProjects`)

### Erro: "Module has no exported member 'X'"
**Causa**: Import incorreto ou membro n√£o existe
**Solu√ß√£o**:
- Verificar se o export existe no arquivo
- Verificar se o caminho do import est√° correto
- Verificar se o nome do export est√° correto

### Erro: "is possibly 'undefined'"
**Causa**: Valor pode ser undefined mas est√° sendo usado sem verifica√ß√£o
**Solu√ß√£o**:
- Usar optional chaining `?.`
- Adicionar verifica√ß√£o `if (value)`
- Usar `|| defaultValue` para valores padr√£o

### Erro: "Property 'X' is missing in type"
**Causa**: Propriedade obrigat√≥ria n√£o est√° sendo passada
**Solu√ß√£o**:
- Adicionar a propriedade ao objeto
- Verificar se a propriedade √© realmente obrigat√≥ria no tipo
- Marcar como opcional `?` se n√£o for obrigat√≥ria

### Erro: "Type 'X' is not assignable to type 'Y'"
**Causa**: Tipo incompat√≠vel
**Solu√ß√£o**:
- Verificar se os tipos s√£o compat√≠veis
- Usar `as` type assertion apenas se necess√°rio e seguro
- Verificar se enums est√£o corretos

## üìã COMANDOS DE VERIFICA√á√ÉO

Antes de commitar, execute:

```bash
# Verificar tipos TypeScript
npm run type-check

# Ou diretamente
tsc --noEmit

# Build completo (simula o que o Vercel far√°)
npm run build
```

## üéØ PADR√ïES DO PROJETO

### Estrutura de Hooks
```typescript
export const useFeature = () => {
  const { currentUser } = useAuth()
  const { currentProject, loading } = useProject() // SEMPRE usar 'loading', n√£o 'loadingProjects'
  
  // Verificar currentProject antes de usar
  if (!currentProject) {
    return { data: [], loading: false }
  }
  
  // Filtrar por projectId
  const constraints = [
    where('projectId', '==', currentProject.id),
    orderBy('createdAt', 'desc')
  ]
}
```

### Estrutura de Tipos
```typescript
export interface Feature extends BaseEntity {
  projectId: string // SEMPRE incluir projectId
  name: string
  // Campos opcionais com ?
  description?: string
  // assignedTo sempre √© projectMemberId, n√£o userId
  assignedTo?: string // projectMemberId
}
```

### Estrutura de Formul√°rios
```typescript
// SEMPRE validar com Zod
const schema = z.object({
  name: z.string().min(1, 'Campo obrigat√≥rio'),
  optionalField: z.string().optional(),
})

// Tratar valores undefined
const data = {
  ...formData,
  optionalField: formData.optionalField || undefined,
}
```

## ‚ö†Ô∏è ATEN√á√ÉO ESPECIAL

### Contextos
- `ProjectContext`: `currentProject`, `setCurrentProject`, `loading`, `isMaster`
- **N√ÉO existe** `loadingProjects` - usar `loading`
- **N√ÉO existe** `projects` - buscar via `useProjects()` hook

### Tipos Importantes
- `Deal.assignedTo` ‚Üí `projectMemberId` (n√£o `userId`)
- `Task.assignedTo` ‚Üí `projectMemberId` (n√£o `userId`)
- `Funnel.type` ‚Üí `'martech' | 'custom'` (n√£o `'sales'`)

### Cole√ß√µes do Firestore
- Todas as cole√ß√µes principais precisam de `projectId`
- Exce√ß√µes: `users`, `closeReasons` (globais)
- `projectUsers` ‚Üí rela√ß√£o usu√°rio-projeto (clientes)
- `projectMembers` ‚Üí respons√°veis/colaboradores do projeto

## üöÄ ANTES DE PUSH

1. ‚úÖ Executar `npm run type-check`
2. ‚úÖ Executar `npm run build` localmente
3. ‚úÖ Verificar console por warnings
4. ‚úÖ Verificar se n√£o h√° imports n√£o utilizados
5. ‚úÖ Verificar se tipos est√£o completos
6. ‚úÖ Verificar se contextos est√£o sendo usados corretamente

## üìù NOTAS IMPORTANTES

- **NUNCA** commitar c√≥digo com erros de TypeScript
- **SEMPRE** verificar tipos antes de usar propriedades de contextos
- **SEMPRE** incluir `projectId` em cria√ß√µes de documentos
- **SEMPRE** filtrar por `projectId` em queries
- **NUNCA** usar emojis - sempre √≠cones profissionais
- **SEMPRE** verificar se imports est√£o corretos e n√£o h√° n√£o utilizados

---

**√öltima atualiza√ß√£o**: 2024
**Vers√£o**: 1.0

